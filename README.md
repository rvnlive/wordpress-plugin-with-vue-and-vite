# WordPress Vue Plugin Integration

This guide provides step-by-step instructions on how to integrate a Vue 3 application (with Vite) within a WordPress plugin,
including setting up a development environment with Docker, managing file naming for easy integration, and embedding Vue within the WordPress admin area.

## Table of Contents

- [Project Setup](#project-setup)
- [Docker Configuration](#docker-configuration)
- [WordPress Plugin Structure](#wordpress-plugin-structure)
- [Integrating Vue with WordPress](#integrating-vue-with-wordpress)
- [Custom Admin Menu](#custom-admin-menu)
- [Vite Configuration](#vite-configuration)

## Project Setup

This starter template is ready to use with Docker and Vite, and it includes a basic WordPress plugin structure.

If you wish to use this template, clone the repository, and from `wordpress-plugin-with-vue-and-vite` - run `npm install` to install the Vue application dependencies.

Then, run `docker-compose up` to start the WordPress server - which will be available at `http://localhost:8000` and will (should) already have the plugin available.

Just visit the WordPress admin area and activate the plugin to see the Vue application in action.

If you want to test out changes, run `npm run watch` to start the Vite development server, and the changes will be reflected in the WordPress admin area immediately.
> **Note:** when changes detected in the `src` directory, the build happens automatically, and the build files are output to the `wordpress-plugin/dist` directory,
> which is where the WordPress plugin will look for the Vue application files and the admin page will display the updated Vue application.

----

> *However, if you wish to set up your own project, follow the steps below:*

Start by structuring your project to include both your Vue application and your WordPress plugin code.

```plaintext
wordpress-plugin-with-vue-and-vite/
│
├── src/                             (Vue application directory)
├── vite.config.js                   (Vite configuration file)
├── package.json                     (Vue application dependencies)
├── Dockerfile                       (WordPress Docker configuration)
├── docker-compose.yml               (WordPress Docker configuration)
└── wordpress-plugin/                (WordPress plugin directory)
    ├── my-vue-plugin.php            (main plugin file)
    ├── admin-style/                 (optional - for custom admin styles)
    │   └── admin-style.css
    └── dist/                        (generated by Vite - contains the Vue application build files)
    │   ├── assets/ 
    │   │   ├── index.js
    │   │   └── index.css
    │   └── index.html
    └── img/                         (optional - for images and icons, mainly used in the admin area)
    └── includes/                    (optional - for additional PHP files and functions)
```

## Docker Configuration

Your `docker-compose.yml` should look something like this:

```yaml
version: '3.8'
services:
  wordpress:
    build: .
    ports:
      - "8000:80"
    volumes:
      - wordpress_data:/var/www/html
      - ./wordpress-plugin:/var/www/html/wp-content/plugins/wordpress-plugin
    depends_on:
      - db
  db:
    image: mysql:5.7
    environment:
      MYSQL_ROOT_PASSWORD: wordpress
      MYSQL_DATABASE: wordpress
      MYSQL_USER: wordpress
      MYSQL_PASSWORD: wordpress
    volumes:
      - db_data:/var/lib/mysql
volumes:
  wordpress_data:
  db_data:
```

## WordPress Plugin Structure

Your main plugin file (`my-vue-plugin.php`) should register the plugin and enqueue necessary scripts:

```php
<?php
/*
Plugin Name: My Vue Plugin
Description: A plugin integrating a Vue 3 and Vite application with WordPress.
*/

function enqueue_scripts() {
    wp_enqueue_script('my-vue-app-js', plugin_dir_url(__FILE__) . 'dist/assets/index.js', array(), '1.0.0', true);
    wp_enqueue_style('my-vue-app-css', plugin_dir_url(__FILE__) . 'dist/assets/index.css', array(), '1.0.0');
}

...

// Hook
add_action('wp_enqueue_scripts', 'enqueue_scripts');
```

## Integrating Vue with WordPress

### Custom Admin Menu

To add a sidebar option in WordPress admin:

```php
// Add a top-level admin menu for the Vue plugin (left sidebar)
function add_admin_menu() {
    add_menu_page(
        'My Vue Plugin',              // Page title
        'Vue Plugin',                 // Menu title
        'manage_options',             // Capability required
        'my-vue-plugin',              // Menu slug
        'page_html',                  // Function to display the page content
        100                           // Position
    );
}

// Callback to output the content of the Vue plugin's admin page
function page_html() {
    if (!current_user_can('manage_options')) {
        return;
    }

    echo '<div class="wrap">';
    echo '<h1>' . esc_html(get_admin_page_title()) . '</h1>';
    echo '<div id="app"></div>'; // Vue app will mount here
    echo '</div>';

    // Enqueue the Vue app scripts and styles specifically for this admin page
    enqueue_scripts();
}

// Style the wordpress menu for the Vue plugin
function admin_styles() {
    wp_enqueue_style('my-vue-plugin-admin-styles', plugin_dir_url(__FILE__) . 'admin-style/admin-style.css');
}

// Hooks
add_action('admin_menu', 'add_admin_menu');
add_action('admin_enqueue_scripts', 'admin_styles');
```

## Vite Configuration

Adjust your `vite.config.js` to maintain file naming without hashes:

```javascript
import {defineConfig} from 'vite';
import vue from '@vitejs/plugin-vue';
import path from 'path'; // Make sure to import 'path'
import {fileURLToPath, URL} from 'url';

// https://vitejs.dev/config/
export default defineConfig({
  build: {
    outDir: path.resolve(__dirname, 'wordpress-plugin/dist'), // Specify the output directory
    rollupOptions: {
      output: {
        // Entry file name for the initial JavaScript file
        entryFileNames: 'assets/index.js',
        // Provide a pattern for chunk files to avoid conflicts, without hash for simplicity
        chunkFileNames: 'assets/[name].js',
        // Asset files (e.g., CSS, images) file naming pattern
        assetFileNames: 'assets/[name].[ext]',
      },
    }
  },
  plugins: [vue()],
  resolve: {
    alias: {
      '@': fileURLToPath(new URL('./src', import.meta.url))
    }
  }
});
```

---

This README provides a simple guide on integrating Vue within a WordPress plugin, ideal for developers looking to leverage Vue's reactivity within WordPress's robust CMS capabilities.
Improvements are still planned, such as adding a REST API to communicate between Vue and WordPress and more.
